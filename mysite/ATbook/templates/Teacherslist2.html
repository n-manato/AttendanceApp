{% extends "base.html" %}
{% load django_bootstrap5 %}
{% load static %}
<!DOCTYPE html>
<html>
    <head>
        {% bootstrap_css %}
        {% bootstrap_javascript %}
    </head>
    <body class="">
        {% block content %}
            <link rel="stylesheet"
                  href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
            <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js"></script>
            <section class="intro">
                <div class="gradient-custom-2 h-100">
                    <div class="mask d-flex align-items-center h-100">
                        <div class="container">
                            <div class="row justify-content-center">
                                <div class="col-12">
                                    <h1 style="color: white;">Teacher: {{ teacher }}</h1>
                                    <form method="POST" id="select-form">
                                        {% csrf_token %}
                                        <div class="row">
                                            <div class="col">
                                                <div class="form-group">
                                                    <label for="select-date" class="form-label" style="color: white;">Select Date:</label>
                                                    <input type="date"
                                                           class="form-control bg-dark text-white border-dark"
                                                           id="select_date"
                                                           name="select_date"
                                                           {% if selected_date %}value="{{ selected_date }}"{% endif %}>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3"></div>
                                    </form>
                                    <div class="table-responsive table-container">
                                        <table id="student-table" class="table table-dark table-bordered mb-0">
                                            <thead>
                                                <th scope="col">Full Name</th>
                                                <th scope="col">Total</th>
                                                {% for subject_data in subject_list %}<th>{{ subject_data }}</th>{% endfor %}
                                            </thead>
                                            <tbody>
                                                {% for fullname, subject in attendance_dict.items %}
                                                    <tr>
                                                        <td>{{ fullname }}</td>
                                                        <td>{{ subject.total }}</td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="row justify-content-center mt-3">
                                    <div class="col-6">
                                        <button type="csv" id="csv-btn" class="btn btn-primary w-100" name="csv">Download CSV</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            {% endblock %}
            {% block scripts %}
                <script src="{% static 'js/jquery.min.js' %}"></script>
                <script>
$(document).ready(function() {
    var csrftoken = "{{ csrf_token }}";

    function sendPOSTRequest() {
        var selectedDate = $("#select_date").val();
        if (selectedDate !== "") {
            $("#select-form").submit();
        }
    }

    // ドロップダウンメニューの変更を監視
    $("#select_date").change(function() {
        event.preventDefault();
        sendPOSTRequest(); // ドロップダウンメニューが変更されたらフォームを送信
    });
});
                </script>
            {% endblock %}
        </body>
    </html>
